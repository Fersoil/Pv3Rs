<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Compute posterior probabilities of P. vivax recurrence states — compute_posterior • Pv3Rs</title><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Compute posterior probabilities of P. vivax recurrence states — compute_posterior"><meta name="description" content="Compute posterior probabilities of P. vivax recurrence states relapse,
reinfection and recrudescence using genetic data.
Please note, the progress bar does not necessarily increment uniformly (see
details below); it may seem stuck when the code is still running."><meta property="og:description" content="Compute posterior probabilities of P. vivax recurrence states relapse,
reinfection and recrudescence using genetic data.
Please note, the progress bar does not necessarily increment uniformly (see
details below); it may seem stuck when the code is still running."><meta property="og:image" content="https://aimeertaylor.github.io/Pv3Rs/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">Pv3Rs</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/demonstrate-usage.html">Demonstrate Pv3Rs usage</a></li>
    <li><a class="dropdown-item" href="../articles/enumerate.html">Enumerate graphs and partitions</a></li>
    <li><a class="dropdown-item" href="../articles/intra-episode-siblings.html">Explore treatment of intra-episode siblings</a></li>
    <li><a class="dropdown-item" href="../articles/understand-graph-prior.html">Understand graph prior ramifications</a></li>
    <li><a class="dropdown-item" href="../articles/understand-half-sibs.html">Understand half-sibling misspecification</a></li>
    <li><a class="dropdown-item" href="../articles/understand-posterior.html">Understand posterior estimates</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/aimeertaylor/Pv3Rs/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Compute posterior probabilities of <em>P. vivax</em> recurrence states</h1>
      <small class="dont-index">Source: <a href="https://github.com/aimeertaylor/Pv3Rs/blob/main/R/compute_posterior.R" class="external-link"><code>R/compute_posterior.R</code></a></small>
      <div class="d-none name"><code>compute_posterior.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Compute posterior probabilities of <em>P. vivax</em> recurrence states relapse,
reinfection and recrudescence using genetic data.</p>
<p>Please note, the progress bar does not necessarily increment uniformly (see
details below); it may seem stuck when the code is still running.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">compute_posterior</span><span class="op">(</span></span>
<span>  <span class="va">y</span>,</span>
<span>  <span class="va">fs</span>,</span>
<span>  prior <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  MOIs <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  return.RG <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  return.logp <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  progress.bar <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-y">y<a class="anchor" aria-label="anchor" href="#arg-y"></a></dt>
<dd><p>Observed data in the form of a list of lists. The outer list is a
list of episodes in increasing chronological order. The inner list is a list of named
markers per episode. Episode names can be specified, but they are not used.
Markers must be named. Each episode must list the same markers. If not all
markers are typed per episode, data on untyped markers can be encoded as
missing (see below). For each marker, one must specify an allelic vector: a
set of distinct alleles detected at that marker. <code>NA</code>s encode missing
per-marker data, i.e., when no alleles are observed for a given marker.
<code>NA</code> entries in allelic vectors that contain both <code>NA</code> and
non-<code>NA</code> entries are ignored. Allele names are arbitrary, but must
correspond with frequency names (see examples below). The same names can be
used for alleles belonging to different markers. As such, frequencies must
be specified per named allele per named marker.</p></dd>


<dt id="arg-fs">fs<a class="anchor" aria-label="anchor" href="#arg-fs"></a></dt>
<dd><p>List of per-marker allele frequency vectors. Names of the list must match
with the marker names in <code>y</code>. Within lists (i.e., for each marker),
frequencies must be specified per allele name.</p></dd>


<dt id="arg-prior">prior<a class="anchor" aria-label="anchor" href="#arg-prior"></a></dt>
<dd><p>Matrix of prior probabilities of the recurrence states for each
recurrent episode. Each row corresponds to an episode in increasing
chronological order. The column names must be C, L, and I for
recrudescence, relapse and reinfection respectively. Row names can be
specified but they are not used. If <code>prior</code> is NULL (default), per-episode
recurrence states are equally likely.</p></dd>


<dt id="arg-mois">MOIs<a class="anchor" aria-label="anchor" href="#arg-mois"></a></dt>
<dd><p>Multiplicity of infection for each episode. If MOIs are not
provided, the most parsimonious MOIs compatible with the data will be used;
see <code><a href="determine_MOIs.html">determine_MOIs</a></code>.</p></dd>


<dt id="arg-return-rg">return.RG<a class="anchor" aria-label="anchor" href="#arg-return-rg"></a></dt>
<dd><p>Boolean for whether to return the relationship graphs,
defaults to <code>FALSE</code>. If <code>return.logp</code> is set to <code>TRUE</code>, then <code>return.RG</code>
is overridden to be <code>TRUE</code>, as log-probabilities are returned for each
relationship graph.</p></dd>


<dt id="arg-return-logp">return.logp<a class="anchor" aria-label="anchor" href="#arg-return-logp"></a></dt>
<dd><p>Boolean for whether to return the log-likelihood for each
relationship graph, defaults to <code>FALSE</code>. When setting <code>return.logp</code> to
<code>TRUE</code>, <code>return.RG</code> should also be set to <code>TRUE</code>. Setting <code>return.logp</code> to
<code>FALSE</code> allows for permutation symmetries to be exploited to save
computational time, see <code><a href="enumerate_alleles.html">enumerate_alleles</a></code>. Setting this to
<code>TRUE</code> will result in longer runtimes, especially when multiplicities of
infection are large. Note that this argument does not affect the output of
the posterior probabilities.</p></dd>


<dt id="arg-progress-bar">progress.bar<a class="anchor" aria-label="anchor" href="#arg-progress-bar"></a></dt>
<dd><p>Boolean for printing progress bars. When <code>TRUE</code>
(default), the progress bar is printed to the screen. Please note that the
progress bar does not necessarily increment uniformly (see details below);
it may seem stuck when the code is still running.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>List containing:</p><dl><dt><code>marg</code></dt>
<dd><p>Matrix of marginal posterior probabilities of
recurrence states for each recurrence, one row per recurrence with "C"
for recrudescence, "L" for relapse, and "I" for reinfection. <code>marg</code> is
a simple summary of <code>joint</code> (see next): each marginal probability of a
recurrence state is a sum over a subset of joint probabilities of
recurrence state sequences. For example, the marginal probability of "C"
at the first of two recurrences is a sum over the joint probabilities
of "CC", "CL", and "CI".</p></dd>

<dt><code>joint</code></dt>
<dd><p>Vector of joint posterior probabilities of each recurrent
state sequence, where within a sequence "C" denotes recrudescence,
"L" denotes relapse, and "I" denotes reinfection.</p></dd>

<dt><code>RGs</code></dt>
<dd><p>List of relationship graphs with their log-likelihoods stored.
Only returned if <code>return.RG</code> is <code>TRUE</code>. See
<code><a href="enumerate_RGs.html">enumerate_RGs</a></code>.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code>compute_posterior()</code> computes posterior probabilities proportional to the likelihood multiplied by the prior. The likelihood
sums over</p><ul><li><p>ways to phase allelic data onto haploid genotypes</p></li>
<li><p>graphs of relationships between haploid genotypes</p></li>
<li><p>ways to partition alleles into clusters of identity-by-descent</p></li>
</ul><p><code>compute_posterior()</code> expects each per-episode, per-marker allelic
vector to be a set of distinct alleles. Allele repeats at markers with
observed data, and <code>NA</code> repeats at markers with missing data, are
removed in a data pre-processing step. <code>NA</code>s in allelic vectors that
also contain non-<code>NA</code> values are removed in a data pre-processing step.</p>
<p>We enumerate all possible relationship graphs between haploid genotypes,
where pairs of genotypes can either be clones, siblings, or strangers. The
likelihood of a sequence of recurrence states can be determined from the
likelihood of all relationship graphs compatible with said sequence. More
details on the enumeration and likelihood calculation of relationship graphs
can be found in <code><a href="enumerate_RGs.html">enumerate_RGs</a></code> and <code><a href="RG_inference.html">RG_inference</a></code>
respectively. For each relationship graph, the model sums over all possible
identity-by-descent partitions. Because some relationship graphs are
compatible with more identity-by-descent partitions than others, the log
p(Y|RG) progress bar does not necessarily increment uniformly.</p>
<p>Notable model assumptions and limitations:</p><ul><li><p>Perfect detection of alleles (no genotyping error)</p></li>
<li><p>No within-host <em>de novo</em> mutations</p></li>
<li><p>Parasites are outbred</p></li>
<li><p>All siblings are regular siblings</p></li>
<li><p>Relationship graphs compatible with a given sequence of recurrent
states are equally likely <em>a priori</em></p></li>
<li><p>We do not recommend running `compute_posterior() when the total
genotype count (sum of per-episode multiplicities of infection) exceeds
eight, because there are too many relationship graphs.</p></li>
<li><p>Presently, <code>Pv3Rs</code> only supports prevalence data (categorical data that
signal the detection of alleles), not quantitative data (data that signal the proportional
abundance of the alleles detected).</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># ===========================================================================</span></span></span>
<span class="r-in"><span><span class="co"># Example where alleles are named numerically</span></span></span>
<span class="r-in"><span><span class="co"># ===========================================================================</span></span></span>
<span class="r-in"><span><span class="co"># Data</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>enroll <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'3'</span>,<span class="st">'2'</span><span class="op">)</span>, m2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'1'</span>,<span class="st">'2'</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>          recur1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'1'</span>,<span class="st">'4'</span><span class="op">)</span>, m2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'1'</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>          recur2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'1'</span><span class="op">)</span>, m2 <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Allele frequencies</span></span></span>
<span class="r-in"><span><span class="va">fs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'1'</span> <span class="op">=</span> <span class="fl">0.78</span>, <span class="st">'2'</span> <span class="op">=</span> <span class="fl">0.14</span>, <span class="st">'3'</span> <span class="op">=</span> <span class="fl">0.07</span>, <span class="st">'4'</span> <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           m2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'1'</span> <span class="op">=</span> <span class="fl">0.27</span>, <span class="st">'2'</span> <span class="op">=</span> <span class="fl">0.73</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Compute posterior probabilities using default prior</span></span></span>
<span class="r-in"><span><span class="fu">compute_posterior</span><span class="op">(</span><span class="va">y</span>, <span class="va">fs</span>, progress.bar <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Number of valid relationship graphs (RGs) is 250</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Computing log p(Y|RG) for 250 RGs</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Finding log-likelihood of each vector of recurrence states</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $marg</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                C         L         I</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> recur1 0.0000000 0.1949556 0.8050444</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> recur2 0.2938829 0.2476598 0.4584573</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $joint</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         CC         LC         IC         CL         LL         IL         CI </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.00000000 0.05539481 0.23848807 0.00000000 0.05314490 0.19451493 0.00000000 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         LI         II </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.08641590 0.37204139 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># ===========================================================================</span></span></span>
<span class="r-in"><span><span class="co"># Example where alleles are named arbitrarily and probabilities are plotted</span></span></span>
<span class="r-in"><span><span class="co"># ===========================================================================</span></span></span>
<span class="r-in"><span><span class="co"># Data</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>episode0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>marker1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Tinky Winky"</span>, <span class="st">"Dipsy"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                          marker2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Tinky Winky"</span>, <span class="st">"Laa-Laa"</span>, <span class="st">"Po"</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>          episode1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>marker1 <span class="op">=</span> <span class="st">"Tinky Winky"</span>,</span></span>
<span class="r-in"><span>                          marker2 <span class="op">=</span> <span class="st">"Laa-Laa"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Allele frequencies</span></span></span>
<span class="r-in"><span><span class="va">fs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>marker1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Tinky Winky"</span> <span class="op">=</span> <span class="fl">0.4</span>, <span class="st">"Dipsy"</span> <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           marker2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Tinky Winky"</span> <span class="op">=</span> <span class="fl">0.1</span>, <span class="st">"Laa-Laa"</span> <span class="op">=</span> <span class="fl">0.1</span>, <span class="st">"Po"</span> <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Compute posterior probabilities using default prior</span></span></span>
<span class="r-in"><span><span class="va">posterior_probs</span> <span class="op">&lt;-</span> <span class="fu">compute_posterior</span><span class="op">(</span><span class="va">y</span>, <span class="va">fs</span>, progress.bar <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Number of valid relationship graphs (RGs) is 30</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Computing log p(Y|RG) for 30 RGs</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Finding log-likelihood of each vector of recurrence states</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Plot posterior probabilities on the simplex</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot_simplex.html">plot_simplex</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Recrudescence"</span>, <span class="st">"Relapse"</span>, <span class="st">"Reinfection"</span><span class="op">)</span>, <span class="fl">0.5</span><span class="op">)</span> <span class="co"># Simplex</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-in"><span><span class="va">xy</span> <span class="op">&lt;-</span> <span class="fu"><a href="project2D.html">project2D</a></span><span class="op">(</span><span class="va">posterior_probs</span><span class="op">$</span><span class="va">marg</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span> <span class="co"># Project probabilities</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">xy</span><span class="op">[</span><span class="st">"x"</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">xy</span><span class="op">[</span><span class="st">"y"</span><span class="op">]</span>, pch <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="co"># Plot projected probabilities</span></span></span>
<span class="r-plt img"><img src="compute_posterior-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#============================================================================</span></span></span>
<span class="r-in"><span><span class="co"># Demonstrating the return of the prior when all data are missing</span></span></span>
<span class="r-in"><span><span class="co">#============================================================================</span></span></span>
<span class="r-in"><span><span class="co"># Data</span></span></span>
<span class="r-in"><span><span class="va">y_missing</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>enroll <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                  recur1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                  recur2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Return of the prior</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="fu">compute_posterior</span><span class="op">(</span><span class="va">y_missing</span>, fs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Markers m1 has data on one episode only</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Episodes enroll &amp; recur1 &amp; recur2 have no data</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $marg</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                C         L         I</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> recur1 0.3333333 0.3333333 0.3333333</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> recur2 0.3333333 0.3333333 0.3333333</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $joint</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        CC        LC        IC        CL        LL        IL        CI        LI </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111 0.1111111 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        II </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.1111111 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Return of the prior re-weighted to the exclusion of recrudescence</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="fu">compute_posterior</span><span class="op">(</span><span class="va">y_missing</span>, fs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 MOIs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Markers m1 has data on one episode only</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Episodes enroll &amp; recur1 &amp; recur2 have no data</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $marg</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        C   L   I</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> recur1 0 0.5 0.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> recur2 0 0.5 0.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $joint</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   CC   LC   IC   CL   LL   IL   CI   LI   II </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.00 0.00 0.00 0.00 0.25 0.25 0.00 0.25 0.25 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># (Recrudescing parasites are clones of previous blood-stage parasites. The</span></span></span>
<span class="r-in"><span><span class="co"># Pv3R model assumes no within-host de-novo mutations and perfect allele</span></span></span>
<span class="r-in"><span><span class="co"># detection. As such, recrudescence is incompatible with an MOI increase on</span></span></span>
<span class="r-in"><span><span class="co"># the preceding infection.)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># ===========================================================================</span></span></span>
<span class="r-in"><span><span class="co"># Demonstrating the cosmetic-only nature of episode names</span></span></span>
<span class="r-in"><span><span class="co"># ===========================================================================</span></span></span>
<span class="r-in"><span><span class="co"># Data</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>enroll <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>          recur2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>          recur1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Use a non-uniform prior for the purpose of illustration</span></span></span>
<span class="r-in"><span><span class="va">prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>,<span class="fl">0.2</span>,<span class="fl">0.6</span>,<span class="fl">0.7</span>,<span class="fl">0.1</span>,<span class="fl">0.2</span><span class="op">)</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span>, nrow <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>                dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"recur1_prior"</span>, <span class="st">"recur2_prior"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"C"</span>, <span class="st">"L"</span>, <span class="st">"I"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Print posterior and prior, noting that "recur1_prior" is returned for</span></span></span>
<span class="r-in"><span><span class="co"># "recur2", and "recur2_prior" is returned for "recur1"</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="fu">compute_posterior</span><span class="op">(</span><span class="va">y</span>, fs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>a <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>, <span class="va">prior</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">marg</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Data and prior episode names disagree</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Markers m1 has data on one episode only</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Episodes enroll &amp; recur2 &amp; recur1 have no data</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          C   L   I</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> recur2 0.2 0.2 0.6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> recur1 0.7 0.1 0.2</span>
<span class="r-in"><span><span class="va">prior</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                C   L   I</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> recur1_prior 0.2 0.2 0.6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> recur2_prior 0.7 0.1 0.2</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#============================================================================</span></span></span>
<span class="r-in"><span><span class="co"># Demonstrating the informative nature of non-recurrent data</span></span></span>
<span class="r-in"><span><span class="co">#============================================================================</span></span></span>
<span class="r-in"><span><span class="co"># Data and allele frequencies</span></span></span>
<span class="r-in"><span><span class="va">y_het</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'1'</span>, <span class="st">'2'</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y_hom</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="st">'1'</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'1'</span> <span class="op">=</span> <span class="fl">0.5</span>, <span class="st">'2'</span> <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># The prior is not returned despite there being no recurrent data.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="fu">compute_posterior</span><span class="op">(</span>y <span class="op">=</span> <span class="va">y_het</span>, <span class="va">fs</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">marg</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Markers m1 has data on one episode only</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              C         L         I</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 0.3292683 0.3414634 0.3292683</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="fu">compute_posterior</span><span class="op">(</span>y <span class="op">=</span> <span class="va">y_hom</span>, <span class="va">fs</span>, MOIs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">marg</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Markers m1 has data on one episode only</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              C         L         I</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 0.3358209 0.3283582 0.3358209</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#============================================================================</span></span></span>
<span class="r-in"><span><span class="co"># Demonstrating the effect of increasingly large relationship graphs: the</span></span></span>
<span class="r-in"><span><span class="co"># marginal probability of the first recurrence changes slightly, albeit at a</span></span></span>
<span class="r-in"><span><span class="co"># decreasing rate, as the number of additional recurrences (all without data)</span></span></span>
<span class="r-in"><span><span class="co"># increases. The change is greatest when the observed allele is rare.</span></span></span>
<span class="r-in"><span><span class="co">#============================================================================</span></span></span>
<span class="r-in"><span><span class="co"># Data for different recurrence counts where only the 1st recurrence has data</span></span></span>
<span class="r-in"><span><span class="va">ys</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>scenario1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>enroll <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                            recur1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           scenario2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>enroll <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                            recur1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                            recur2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           scenario3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>enroll <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                            recur1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                            recur2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                            recur3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           scenario4 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>enroll <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                            recur1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="st">"A"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                            recur2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                            recur3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                            recur4 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Allele frequencies: smaller f_A leads to larger change</span></span></span>
<span class="r-in"><span><span class="va">f_A</span> <span class="op">&lt;-</span> <span class="fl">0.1</span>; <span class="va">fs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span> <span class="op">=</span> <span class="va">f_A</span>, <span class="st">"Other"</span> <span class="op">=</span> <span class="fl">1</span><span class="op">-</span><span class="va">f_A</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Compute posterior probabilities and extract marginal probabilities</span></span></span>
<span class="r-in"><span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">ys</span>, <span class="kw">function</span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="fu">compute_posterior</span><span class="op">(</span><span class="va">y</span>, <span class="va">fs</span>, progress.bar <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">marg</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Number of valid relationship graphs (RGs) is 3</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Computing log p(Y|RG) for 3 RGs</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Finding log-likelihood of each vector of recurrence states</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Episode recur2 has no data</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Number of valid relationship graphs (RGs) is 12</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Computing log p(Y|RG) for 12 RGs</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Finding log-likelihood of each vector of recurrence states</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Episodes recur2 &amp; recur3 have no data</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Number of valid relationship graphs (RGs) is 60</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Computing log p(Y|RG) for 60 RGs</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Finding log-likelihood of each vector of recurrence states</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Episodes recur2 &amp; recur3 &amp; recur4 have no data</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Number of valid relationship graphs (RGs) is 358</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Computing log p(Y|RG) for 358 RGs</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Finding log-likelihood of each vector of recurrence states</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Extract results for the first recurrence</span></span></span>
<span class="r-in"><span><span class="va">results_recur1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">results</span>, <span class="kw">function</span><span class="op">(</span><span class="va">result</span><span class="op">)</span> <span class="va">result</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">results_recur1</span> <span class="co"># Results are different for different scenarios</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    scenario1  scenario2  scenario3  scenario4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> C 0.60606061 0.61538462 0.62294515 0.62925894</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> L 0.33333333 0.32307692 0.31476034 0.30781517</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> I 0.06060606 0.06153846 0.06229451 0.06292589</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Visualise the change in the marginal probability of the first recurrence</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot_simplex.html">plot_simplex</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Recrudescence"</span>, <span class="st">"Relapse"</span>, <span class="st">"Reinfection"</span><span class="op">)</span><span class="op">)</span> <span class="co"># Plot simplex</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-in"><span><span class="va">xy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">results_recur1</span>, <span class="fl">2</span>, <span class="va">project2D</span><span class="op">)</span> <span class="co"># Project probabilities</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">xy</span><span class="op">[</span><span class="st">"x"</span>, <span class="op">]</span>, y <span class="op">=</span> <span class="va">xy</span><span class="op">[</span><span class="st">"y"</span>, <span class="op">]</span>, pch <span class="op">=</span> <span class="st">"-"</span>, col <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span> <span class="co"># Plot projections</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"left"</span>, col <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, pch <span class="op">=</span> <span class="st">"-"</span>, pt.cex <span class="op">=</span> <span class="fl">2</span>, bty <span class="op">=</span> <span class="st">"n"</span>, legend <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,</span></span>
<span class="r-in"><span>title <span class="op">=</span> <span class="st">"Recurrence \n count"</span><span class="op">)</span> <span class="co"># legend</span></span></span>
<span class="r-plt img"><img src="compute_posterior-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Aimee Taylor, Yong See Foo, European Union, Project 101110393 — PvRecur.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

